# -*- coding: utf-8 -*-
# ---------------------------------------------------------------------------
# network_analysis_jc_ks.py
# Created on: 2017-05-09 09:02:49.00000
#   (generated by ArcGIS/ModelBuilder)
# Usage: network_analysis_jc_ks <Input_Stop_Locations> <Filter_Stop_Locations> <Choose_Route_Network_Dataset> <Impedance_Attribute> <Restrictions> <Accumulators> <Output_Path_Shape> <U_Turn_Policy> <Use_Hierarchy_in_Analysis> <Field_Mappings> <Sort_Field> <Group_By_Fields> 
# Description: 
# ---------------------------------------------------------------------------

# Import arcpy module
import arcpy

# Load required toolboxes
arcpy.ImportToolbox("Model Functions")

# Script arguments
Input_Stop_Locations = arcpy.GetParameterAsText(0)
if Input_Stop_Locations == '#' or not Input_Stop_Locations:
    Input_Stop_Locations = "\\\\Mac\\Home\\Documents\\Planning\\DataManagement\\DataManagement.gdb\\BART_OD_Trips_StationUpd_Pro" # provide a default value if unspecified

Filter_Stop_Locations = arcpy.GetParameterAsText(1)
if Filter_Stop_Locations == '#' or not Filter_Stop_Locations:
    Filter_Stop_Locations = "Route_ID ='11977_338'" # provide a default value if unspecified

Choose_Route_Network_Dataset = arcpy.GetParameterAsText(2)
if Choose_Route_Network_Dataset == '#' or not Choose_Route_Network_Dataset:
    Choose_Route_Network_Dataset = "\\\\Mac\\Home\\Documents\\GIS Data\\TomTomData\\TomTom_2015_12_NW.gdb\\Routing\\Routing_ND" # provide a default value if unspecified

Impedance_Attribute = arcpy.GetParameterAsText(3)
if Impedance_Attribute == '#' or not Impedance_Attribute:
    Impedance_Attribute = "Miles" # provide a default value if unspecified

Restrictions = arcpy.GetParameterAsText(4)
if Restrictions == '#' or not Restrictions:
    Restrictions = "'Avoid Ferries';'Avoid Four Wheel Drive Only Roads'" # provide a default value if unspecified

Accumulators = arcpy.GetParameterAsText(5)
if Accumulators == '#' or not Accumulators:
    Accumulators = "Miles;Minutes" # provide a default value if unspecified

Output_Path_Shape = arcpy.GetParameterAsText(6)
if Output_Path_Shape == '#' or not Output_Path_Shape:
    Output_Path_Shape = "TRUE_LINES_WITHOUT_MEASURES" # provide a default value if unspecified

U_Turn_Policy = arcpy.GetParameterAsText(7)
if U_Turn_Policy == '#' or not U_Turn_Policy:
    U_Turn_Policy = "ALLOW_UTURNS" # provide a default value if unspecified

Use_Hierarchy_in_Analysis = arcpy.GetParameterAsText(8)
if Use_Hierarchy_in_Analysis == '#' or not Use_Hierarchy_in_Analysis:
    Use_Hierarchy_in_Analysis = "true" # provide a default value if unspecified

Field_Mappings = arcpy.GetParameterAsText(9)
if Field_Mappings == '#' or not Field_Mappings:
    Field_Mappings = "Name Route_ID #;RouteName Route_ID #" # provide a default value if unspecified

Sort_Field = arcpy.GetParameterAsText(10)
if Sort_Field == '#' or not Sort_Field:
    Sort_Field = "Stop_No" # provide a default value if unspecified

Group_By_Fields = arcpy.GetParameterAsText(11)
if Group_By_Fields == '#' or not Group_By_Fields:
    Group_By_Fields = "Route_ID #" # provide a default value if unspecified

# Local variables:
Output_Layer = "BART_OD_Trips_StationUpd_Pro"
Selected_Features = Output_Layer
Value = "11977_338"
Network_Analyst_Layer = "Route"
Route = Network_Analyst_Layer
Route__2_ = Route
Solve_Succeeded = "false"
Output_Elements = Route__2_
Child_Data_Element = "Routes"
HHTS_Trips__2_ = Output_Elements
HHTS_Trips = "\\\\Mac\\Home\\Documents\\Planning\\DataManagement\\DataManagement.gdb\\utm\\HHTS_Trips"

# Process: Make Feature Layer
arcpy.MakeFeatureLayer_management(Input_Stop_Locations, Output_Layer, Filter_Stop_Locations, "", "OBJECTID OBJECTID VISIBLE NONE;Shape Shape VISIBLE NONE;Route_ID Route_ID VISIBLE NONE;Trip_ID Trip_ID VISIBLE NONE;Stop_No Stop_No VISIBLE NONE;OR_ADDRESS_CITY OR_ADDRESS_CITY VISIBLE NONE;OR_ADDRESS_ZIP OR_ADDRESS_ZIP VISIBLE NONE;station_name station_name VISIBLE NONE;SourceID SourceID VISIBLE NONE;SourceOID SourceOID VISIBLE NONE;PosAlong PosAlong VISIBLE NONE;SideOfEdge SideOfEdge VISIBLE NONE;SnapX SnapX VISIBLE NONE;SnapY SnapY VISIBLE NONE;DistanceToNetworkInMeters DistanceToNetworkInMeters VISIBLE NONE")

# Process: Iterate Feature Selection
arcpy.IterateFeatureSelection_mb(Output_Layer, Group_By_Fields, "false")

# Process: Make Route Layer
arcpy.MakeRouteLayer_na(Choose_Route_Network_Dataset, "Route", Impedance_Attribute, "USE_INPUT_ORDER", "PRESERVE_BOTH", "NO_TIMEWINDOWS", Accumulators, U_Turn_Policy, Restrictions, Use_Hierarchy_in_Analysis, "", Output_Path_Shape, "")

# Process: Add Locations
arcpy.AddLocations_na(Network_Analyst_Layer, "Stops", Selected_Features, Field_Mappings, "5000 Meters", Sort_Field, "Streets SHAPE;Routing_ND_Junctions NONE", "MATCH_TO_CLOSEST", "CLEAR", "NO_SNAP", "5 Meters", "INCLUDE", "Streets #;Routing_ND_Junctions #")

# Process: Solve
arcpy.Solve_na(Route, "SKIP", "TERMINATE", "")

# Process: Select Data
arcpy.SelectData_management(Route__2_, Child_Data_Element)

# Process: Append
arcpy.Append_management("Route\\Routes", HHTS_Trips, "NO_TEST", "", "")

